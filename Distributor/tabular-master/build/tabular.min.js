/*! tabular v0.1.0
 * https://github.com/lugolabs/tabular#readme
 * 
 * Copyright: Artan Sinani 2016
 * Released under MIT license
 * https://github.com/lugolabs/tabular/blob/master/LICENCE
 * 
 * Date: 2017-01-08
 */

!function(a,b){"use strict";var c=a.tabular={};$.extend(c,{start:function(a,b){var d={plugins:["Model","Pagination","Sort","Search","Loader"]};b=$.extend({},d,b);var e=$(a);return $.map(b.plugins,function(a){var d,f=c[a];"object"==typeof a&&$.each(a,function(a,b){f=c[a],d=b}),new f(e,b,d)}),new c.View(e,b),e}}),c.Loader=function(a,b){this._element=a,this._options=b,this._init()},c.Loader.prototype={destroy:function(){this._element.off("model:startFetch.tabularLoader model:stopFetch.tabularLoader")},_init:function(){this._loader=$("<div/>").addClass("tabular-loader").text("Loading ...").appendTo(this._element),this._bind()},_bind:function(){this._element.on("model:startFetch.tabularLoader",$.proxy(this,"_start")),this._element.on("model:stopFetch.tabularLoader",$.proxy(this,"_stop"))},_start:function(){this._loader.show()},_stop:function(){this._loader.hide()}},c.Model=function(a,b){this._element=a,this._options=b,this._element.on("model:fetch.tabularModel",$.proxy(this,"_fetch"))},c.Model.prototype={_metadata:{},destroy:function(){this._element.off("model:fetch.tabularModel")},_fetch:function(a,b,c){this._element.trigger("model:startFetch"),c?this._metadata=b:b&&$.extend(this._metadata,b),$.ajax({url:this._options.source,data:this._metadata,success:$.proxy(this,"_processResponse")})},_processResponse:function(a){this._element.trigger("model:stopFetch",a),this._element.trigger("model:success",a)}},c.Pagination=function(a,b,d){this._element=a,this._options=b,this._myOptions=d||{},this._pageSizes=this._myOptions.pageSizes||c.Pagination.PAGE_SIZES,this._pageSize=this._pageSizes[0],this._init()},c.Pagination.PAGE_SIZES=[10,25,50],c.Pagination.prototype={_page:1,destroy:function(){this._element.off("model:success.tabularPagination view:header.tabularPagination"),this._paginator.remove()},_init:function(){this._element.on("view:header.tabularPagination",$.proxy(this,"_setup")),this._element.on("model:success.tabularPagination",$.proxy(this,"_render"))},_render:function(a,b){this._page=b.metadata.current_page,this._totalPages=b.metadata.total_pages,this._pageSize=b.metadata.page_size||this._pageSizes[0];var c={totalPages:this._totalPages};(0===this._totalPages||this._page<2)&&(c.prevDisabled=!0),0!==this._totalPages&&this._page!==this._totalPages||(c.nextDisabled=!0);var d=this._markup(c);this._paginator.html(d)},_setup:function(a,b){var c=this._markup({prevDisabled:!0,nextDisabled:!0,totalPages:1});this._paginator=$('<div class="tabular-paginator"/>').html(c).on("click","button",$.proxy(this,"_clickButton")).on("change",'select[data-action="page"]',$.proxy(this,"_changePage")).on("change",'select[data-action="size"]',$.proxy(this,"_changeSize")).appendTo(b),this._myOptions.containerClass&&this._paginator.addClass(this._myOptions.containerClass)},_changePage:function(){this._fetch(this._paginator.find('[data-action="page"]').val())},_changeSize:function(){this._fetch(1)},_clickButton:function(a){var b,c=$(a.target).data("action");switch(c){case"first":b=1;break;case"prev":b=this._page-1;break;case"next":b=this._page+1;break;case"last":b=this._totalPages}b&&this._fetch(b)},_fetch:function(a){this._element.trigger("model:fetch",{page:a,page_size:this._paginator.find('[data-action="size"]').val()})},_markup:function(a){var b=a.prevDisabled?' disabled="disabled"':"",c=a.nextDisabled?' disabled="disabled"':"",d="";this._myOptions.buttonClass&&(d=" "+this._myOptions.buttonClass);var e=['<div class="tabular-paginator-btns">','<button type="button" class="tabular-btn tabular-paginator-btn'+d+'" data-action="first"'+b+">First</button>",'<button type="button" class="tabular-btn tabular-paginator-btn'+d+'" data-action="prev"'+b+">Previous</button>",this._buildPagesSelect(a.totalPages),'<button type="button" class="tabular-btn tabular-paginator-btn'+d+'" data-action="next"'+c+">Next</button>",'<button type="button" class="tabular-btn tabular-paginator-btn'+d+'" data-action="last"'+c+">Last</button>","</div>",this._buildPageSizes()];return e.join("")},_buildPageSizes:function(){for(var a=['<div class="tabular-paginator-info">','<select class="tabular-paginator-sizes" data-action="size">'],b=0,c=this._pageSizes.length;b<c;b++){var d=this._pageSizes[b],e=d===this._pageSize?' selected="selected"':"";a.push('<option value="'+d+'"'+e+">"+d+" rows</option>")}return a.push("</select> per page</div>"),a.join("")},_buildPagesSelect:function(a){if(!(a<=1)){for(var b=[],c=1;c<=a;c++){var d=c===this._page?" selected ":"";b.push('<option value="'+c+'"'+d+">"+c+"</option>")}var e="<select";return this._myOptions.selectClass&&(e+=' class="'+this._myOptions.selectClass+'"'),e+' data-action="page">'+b.join("")+"</select>"}}},c.Search=function(a,b,c){this._element=a,this._options=b,this._myOptions=c||{},this._init()},c.Search.prototype={destroy:function(){this._input.remove(),this._form.remove(),this._element.off("view:header.tabularSearch")},_init:function(){this._element.on("view:header.tabularSearch",$.proxy(this,"_setup"))},_setup:function(a,b){this._form=$('<form class="tabular-search"/>'),this._input=$('<input type="search" name="q" placeholder="Search ..." />').on("keyup",$.proxy(this,"_search")).appendTo(this._form),this._form.prependTo(b).on("submit",$.proxy(this,"_submitSearch")),this._addCss()},_addCss:function(){this._myOptions.formClass&&this._form.addClass(this._myOptions.formClass),this._myOptions.inputClass&&this._input.addClass(this._myOptions.inputClass)},_submitSearch:function(a){a.preventDefault(),this._searchNow()},_search:function(a){this._searchTimeout&&clearTimeout(this._searchTimeout),13!==a.which&&(this._searchTimeout=setTimeout($.proxy(this,"_searchNow"),500))},_searchNow:function(a){var b=$.trim(this._input.val());this._element.trigger("model:fetch",[{q:b},!0])}},c.Sort=function(a,b){this._element=a,this._options=b,this._init()},c.Sort.SELECTED_CLASS="tabular-sort-selected",c.Sort.CLICK_EVENT="click.tabularSort",c.Sort.prototype={_DATA_DIRECTION:"data-sort",destroy:function(){this._head&&this._head.off(c.Sort.CLICK_EVENT).html(this._originalMarkup)},getSortingDirection:function(a){return a.attr(this._DATA_DIRECTION)},_init:function(){this._element.on("view:tableHead",$.proxy(this,"_addHead"))},_addHead:function(a,b){this._originalMarkup=b.html(),this._head=b.html(this._markup()).on(c.Sort.CLICK_EVENT,"["+this._DATA_DIRECTION+"]",$.proxy(this,"_onSort"))},_markup:function(){var a=this._DATA_DIRECTION,b=this._options.sort||{},d=b.name,e=b.dir||"asc",f=$.map(this._options.columns,function(b){var f=b.title,g="asc",h=[],i="",j=["tabular-sort"];d===b.name&&(g=e,j.push(c.Sort.SELECTED_CLASS)),b.sort!==!1&&(f='<a href="#sort" '+a+'="'+g+'" data-column="'+b.name+'" class="'+j.join(" ")+'">'+b.title+"</a>",h.push("tabular-sorting")),b.css&&h.push(b.css),h.length>0&&(i=' class="'+h.join(" ")+'"');var k=["<th"+i+">",f,"</th>"];return k.join("")});return"<tr>"+f.join("")+"</tr>"},_onSort:function(a){a.preventDefault();var b=$(a.target),d="asc";b.hasClass(c.Sort.SELECTED_CLASS)&&"asc"===this.getSortingDirection(b)&&(d="desc"),this._setDirection(b,d),this._select(b),this._element.trigger("model:fetch",{sort:{name:b.data("column"),dir:d}})},_select:function(a){this._selectedLink&&this._selectedLink.data("column")!=a.data("column")&&(this._setDirection(this._selectedLink,"asc"),this._selectedLink.removeClass(c.Sort.SELECTED_CLASS)),this._selectedLink=a,this._selectedLink.addClass(c.Sort.SELECTED_CLASS)},_setDirection:function(a,b){a.attr(this._DATA_DIRECTION,b)}},c.View=function(a,b){this._element=a,this._options=b,this._init()},c.View.prototype={destroy:function(){this._element.off("model:success.tabularView")},_init:function(){this._bind(),this._element.addClass("tabular"),this._createElAndTriggerEvent("header",this._options.headerClass),this._addTable(),this._createElAndTriggerEvent("footer",this._options.footerClass),this._fetch()},_fetch:function(){var a=null;this._options.sort&&(a={sort:this._options.sort}),this._element.trigger("model:fetch",a)},_createElAndTriggerEvent:function(a,b){var c=$("<div/>").addClass("tabular-"+a).appendTo(this._element);b&&c.addClass(b),this._element.trigger("view:"+a,[c])},_addTable:function(){this._table=$("<table/>").appendTo(this._element),this._options.tableClass&&this._table.addClass(this._options.tableClass),this._addTableHead(),this._addTableBody()},_addTableHead:function(){var a,b=$.map(this._options.columns,function(b){return a=b.css?' class="'+b.css+'"':"","<th"+a+">"+b.title+"</th>"}),c=$("<thead/>").html("<tr>"+b.join("")+"</th>").appendTo(this._table);this._element.trigger("view:tableHead",[c])},_addTableBody:function(){this._tbody=$("<tbody/>").appendTo(this._table)},_render:function(a,b){this._tbody.html($.map(b.data,$.proxy(this,"_processRow"))),this._element.trigger("view:afterRender",b)},_processRow:function(a){var b,c=$.map(this._options.columns,function(c){return b=c.css?' class="'+c.css+'"':"","<td"+b+">"+a[c.name]+"</td>"});return"<tr>"+c.join("")+"</tr>"},_bind:function(){this._element.on("model:success.tabularView",$.proxy(this,"_render"))}}}(window);
//# sourceMappingURL=tabular.min.js.map